<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=author content="Pawel Grzybek - https://pawelgrzybek.com"><meta name=generator content="Hugo 0.80.0"><title>WebP and AVIF images on a Hugo website | pawelgrzybek.com</title><meta name=description content="After adding support for WebP and AVIF formats, I managed to serve to my visitors around 40% slimmer images. This pretty significant performance gain is simple to achieve using Hugo."><meta property="og:site_name" content="pawelgrzybek.com"><meta property="og:title" content="WebP and AVIF images on a Hugo website | pawelgrzybek.com"><meta property="og:url" content="https://pawelgrzybek.com/webp-and-avif-images-on-a-hugo-website/"><meta property="og:type" content="article"><meta property="og:description" content="After adding support for WebP and AVIF formats, I managed to serve to my visitors around 40% slimmer images. This pretty significant performance gain is simple to achieve using Hugo."><meta property="og:image" content="https://pawelgrzybek.com/photos/2021-01-04.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@pawelgrzybek"><meta name=twitter:creator content="@pawelgrzybek"><link rel=canonical href=https://pawelgrzybek.com/webp-and-avif-images-on-a-hugo-website/><link rel=alternate type=application/rss+xml title=pawelgrzybek.com href=https://pawelgrzybek.com/feed.xml><link rel=alternate type=application/feed+json title=pawelgrzybek.com href=https://pawelgrzybek.com/feed.json><link rel=apple-touch-icon sizes=180x180 href=/assets/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/assets/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/favicon-16x16.png sizes=16x16><link rel=manifest href=/assets/manifest.json><link rel="shortcut icon" href=/assets/favicon.ico><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/mstile-144x144.png"><meta name=theme-color content="#ffffff"><style>:root{--fz: 1rem;--fzb: 106.25%;--lh: 1.764705882rem;--type-scale: 1.25;--color-text: #24292e;--color-background: #fff;--color-link: #005cc5;--color-update-background: #fbebea;--color-update-border: #edb0ab;--color-box-background: #f7f7f7;--color-box-border: #eee;--color-box-border-dark: #ddd;--color-syntax-k: #006699;--color-syntax-s: #cc3300;--color-syntax-m: #ff6600;--color-syntax-c: #999;--color-syntax-nb: #366;--color-syntax-o: #555555;--color-syntax-na: #330099;--color-syntax-nv: #003333}@media screen and (min-width:764px){:root{--fzb: 112.5%;--lh: 1.77778rem}}@media(prefers-color-scheme:dark){:root{--color-text: #fafbfc;--color-background: #24292e;--color-link: #9ecbff;--color-update-background: #6d3733;--color-update-border: #522926;--color-box-background: hsl(210, 12%, 12%);--color-box-border: hsl(210, 12%, 20%);--color-box-border-dark: hsl(210, 12%, 30%);--color-syntax-k: #9ecbff;--color-syntax-s: #f97583;--color-syntax-m: #ffab70;--color-syntax-c: #6a737d;--color-syntax-nb: #28a745;--color-syntax-o: #959da5;--color-syntax-na: #fafbfc;--color-syntax-nv: #00b1b1}}::selection{background:var(--color-link);color:#fff;text-shadow:none}html{font-size:var(--fzb);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;-webkit-text-size-adjust:100%;box-sizing:border-box;scroll-behavior:smooth}*,*::before,*::after{margin:0;padding:0;box-sizing:inherit}body{background-color:var(--color-background);color:var(--color-text);font-family:-apple-system,BlinkMacSystemFont,segoe ui,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;font-size:var(--fz);line-height:var(--lh)}img{display:block;max-width:100%;height:auto;border:0}a{background:0 0;color:var(--color-link);word-wrap:break-word}a:hover,a:focus,a:active{color:var(--color-text)}p,h1,h2,h3,h4,h5,h6{margin-bottom:var(--lh)}h1,h2,h3,h4,h5,h6{margin-top:calc(var(--lh) * 1.5);font-weight:700;text-decoration:none}h1{font-size:calc( var(--fz) * var(--type-scale) * var(--type-scale) * var(--type-scale));line-height:calc(var(--lh) * 1.5)}h2{font-size:calc(var(--fz) * var(--type-scale) * var(--type-scale))}h3{font-size:calc(var(--fz) * var(--type-scale))}h4{font-size:1rem}h5{font-size:calc(var(--fz)/var(--type-scale))}h6{font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale))}ul,ol{margin:0 0 var(--lh)var(--lh)}li ul,li ol{margin:0 0 0 var(--lh)}hr{display:block;height:var(--lh);border:0;box-shadow:0 1px 0 #eee}blockquote{margin-bottom:var(--lh);padding:var(--lh);background:var(--color-box-background);box-shadow:inset 0 0 0 1px var(--color-box-border)}blockquote p{margin:0;font-style:italic}figure{margin-bottom:var(--lh)}figcaption{font-size:var(--fz)/var(--type-scale)/var(--type-scale)}.wrapper{width:100%;max-width:calc(700px + (2 * var(--lh)));margin:0 auto;padding:0 var(--lh)}.wrapper--wide{max-width:calc(900px + (2 * var(--lh)))}.header{position:relative;padding:calc(var(--lh) * 2) 0;display:flex;flex-direction:column}.header__skip{position:absolute;top:0;left:0;padding:0 calc(var(--lh)/2);font-size:calc(var(--fz)/var(--type-scale));transform:scale(0)}.header__skip:focus{transform:scale(1)}.header__logo{display:flex;align-items:center;justify-content:center;margin:0;font-size:calc(var(--fz));line-height:var(--lh)}.header__logo a{display:flex;flex-direction:column;align-items:center;font-weight:700;margin:0 0 calc(var(--lh)/2)}.header__logo a::before{content:"";width:calc(var(--lh) * 2);height:calc(var(--lh) * 2);margin:0 0 calc(var(--lh)/2);background-image:url(/assets/logo.jpg);background-size:100% 100%;border-radius:var(--lh)}.header__list{height:100%;display:flex;align-items:center;justify-content:center;list-style:none;margin:0}.header__item{margin-right:calc(var(--lh)/2)}.header__item:last-of-type{margin-right:0}@media screen and (min-width:764px){.header{flex-direction:row;justify-content:space-between;padding:calc(var(--lh) * 3) 0}.header__logo a{flex-direction:row;margin:0}.header__logo a::before{content:"";width:calc(var(--lh) * 2);height:calc(var(--lh) * 2);margin:0 calc(var(--lh)/2) 0 0;background-image:url(/assets/logo.jpg);background-size:100% 100%;border-radius:var(--lh)}}@media screen and (min-width:964px){.header__logo::after{font-weight:400;white-space:pre;color:var(--color-text);content:" | Software Engineer at Mindera"}}.post{margin-bottom:calc(var(--lh) * 3)}.post__title{margin-top:0}.post__url{color:var(--color-text);text-decoration:none}.post__url:hover{color:var(--color-link)}.post__meta{margin-top:calc(var(--lh) * -1);font-size:calc(var(--fz)/var(--type-scale))}.post__more{text-decoration:none;vertical-align:top}.post__hash{text-decoration:none;margin-left:calc(var(--lh)/4);color:var(--color-text);opacity:.25}.post__hash:hover{color:var(--color-link);opacity:1}.footer{color:var(--color-text);font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));font-weight:700;text-decoration:none;vertical-align:top;padding:calc(var(--lh) * 2) 0}.pager{display:flex}.pager__btn{flex-grow:1;font-size:calc(var(--fz)/var(--type-scale));font-weight:700;text-decoration:none;vertical-align:top}.pager__btn--prev{text-align:left}.pager__btn--next{text-align:right}.share{display:flex;align-items:center;background-color:var(--color-box-background);box-shadow:0 0 0 1px var(--color-box-border);margin:calc(var(--lh) * 2) 0;padding:calc(var(--lh)/2);font-size:calc(var(--fz)/var(--type-scale))}.share__icon{fill:#1da1f2;margin-right:calc(var(--lh)/2);width:var(--fz);height:var(--fz);flex-shrink:0}.share__text{margin:0}.archive{margin-left:0;list-style:none}.archive__item{padding:calc(var(--lh)/2) 0;box-shadow:0 1px 0 0 var(--color-box-border)}.archive__link{font-weight:700;text-decoration:none;color:var(--color-text)}.archive__link:hover{color:var(--color-link)}.archive__date{margin:0;font-size:calc(var(--fz)/var(--type-scale))}code,pre{border-radius:3px;background-color:var(--color-box-background);font-family:SFMono-Regular,Consolas,liberation mono,Menlo,Courier,monospace;font-size:.888889rem;vertical-align:top}pre{margin-bottom:var(--lh);padding:var(--lh);box-shadow:0 0 0 1px var(--color-box-border);overflow-x:auto}p>code,li>code{padding:4px 6px;box-shadow:0 0 0 1px var(--color-box-border)}kbd{border-radius:3px;background-color:var(--color-box-background);font-family:SFMono-Regular,Consolas,liberation mono,Menlo,Courier,monospace;font-size:.888889rem;vertical-align:top;padding:4px 6px;box-shadow:0 0 0 1px var(--color-box-border)}.chroma{background-color:var(--color-box-background)}.chroma .err{background-color:#faa;color:#a00}.chroma .lntd{margin:0;padding:0;border:0;vertical-align:top}.chroma .lntable{display:block;width:auto;margin:0;padding:0;border:0;border-spacing:0;overflow:auto}.chroma .hl{display:block;width:100%;background-color:var(--color-box-border)}.chroma .lnt{display:block;margin-right:.4em;padding:0 .4em;opacity:.5}.chroma .ln{margin-right:.4em;padding:0 .4em}.chroma .k{color:var(--color-syntax-k);font-weight:700}.chroma .kc{color:var(--color-syntax-k);font-weight:700}.chroma .kd{color:var(--color-syntax-k);font-weight:700}.chroma .kn{color:var(--color-syntax-k);font-weight:700}.chroma .kp{color:var(--color-syntax-k)}.chroma .kr{color:var(--color-syntax-k);font-weight:700}.chroma .kt{color:#078;font-weight:700}.chroma .na{color:var(--color-syntax-na)}.chroma .nb{color:var(--color-syntax-nb)}.chroma .nc{color:#0a8;font-weight:700}.chroma .no{color:#360}.chroma .nd{color:#99f}.chroma .ni{color:#999;font-weight:700}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#c0f}.chroma .nl{color:#99f}.chroma .nn{color:#0cf;font-weight:700}.chroma .nt{color:var(--color-syntax-na);font-weight:700}.chroma .nv{color:var(--color-syntax-nv)}.chroma .s{color:var(--color-syntax-s)}.chroma .sa{color:var(--color-syntax-s)}.chroma .sb{color:var(--color-syntax-s)}.chroma .sc{color:var(--color-syntax-s)}.chroma .dl{color:var(--color-syntax-s)}.chroma .sd{color:var(--color-syntax-s);font-style:italic}.chroma .s2{color:var(--color-syntax-s)}.chroma .se{color:var(--color-syntax-s);font-weight:700}.chroma .sh{color:var(--color-syntax-s)}.chroma .si{color:#a00}.chroma .sx{color:var(--color-syntax-s)}.chroma .sr{color:#3aa}.chroma .s1{color:var(--color-syntax-s)}.chroma .ss{color:#fc3}.chroma .m{color:var(--color-syntax-m)}.chroma .mb{color:var(--color-syntax-m)}.chroma .mf{color:var(--color-syntax-m)}.chroma .mh{color:var(--color-syntax-m)}.chroma .mi{color:var(--color-syntax-m)}.chroma .il{color:var(--color-syntax-m)}.chroma .mo{color:var(--color-syntax-m)}.chroma .o{color:var(--color-syntax-o)}.chroma .ow{color:#000;font-weight:700}.chroma .c{color:#999;font-style:italic}.chroma .ch{color:#999;font-style:italic}.chroma .cm{color:#999;font-style:italic}.chroma .c1{color:#999;font-style:italic}.chroma .cs{color:#999;font-style:italic;font-weight:700}.chroma .cp{color:#099}.chroma .cpf{color:#099}.chroma .gd{background-color:#fcc}.chroma .ge{font-style:italic}.chroma .gr{color:red}.chroma .gh{color:#030;font-weight:700}.chroma .gi{background-color:#cfc}.chroma .go{color:#aaa}.chroma .gp{color:#009;font-weight:700}.chroma .gs{font-weight:700}.chroma .gu{color:#030;font-weight:700}.chroma .gt{color:#9c6}.chroma .w{color:#bbb}.update{position:relative;padding:var(--lh);background-color:var(--color-update-background);box-shadow:0 0 0 1px var(--color-update-border)}.update::before{position:absolute;top:calc(var(--lh)/-2);left:calc(var(--lh)/2);height:var(--lh);padding:0 calc(var(--lh)/2);background-color:var(--color-update-border);color:#fff;font-size:calc(var(--fz)/var(--type-scale));font-weight:700;content:"Update"}.comments{list-style:none;margin-left:0}.comments__item{scroll-margin-top:var(--lh)}.comments__item .comments{box-shadow:inset 1px 0 0 var(--color-box-border-dark);padding-left:var(--lh)}.comments__item .comments .comments__author{position:relative}.comments__item .comments .comments__author::before{position:absolute;top:50%;left:calc(var(--lh) * -1);width:calc(var(--lh)/4);height:calc(var(--lh)/4);background:var(--color-box-border-dark);transform:translate(-50%,-50%);border-radius:50%;content:""}.comments__wrapper{margin-bottom:var(--lh);word-wrap:break-word}.comments__author{display:flex;margin-bottom:var(--lh);position:relative}.comments__socials{display:none}@media screen and (min-width:764px){.comments__socials{display:block;position:absolute;top:0;right:0;display:flex}.comments__link{display:block;width:var(--lh);height:var(--lh);background:var(--color-box-background);margin-left:calc(var(--lh)/4);display:flex;justify-content:center;align-items:center;fill:var(--color-text)}.comments__link__icon{width:16px;height:16px;opacity:.5}}.comments__author__photo{width:calc(var(--lh) * 1.5);height:calc(var(--lh) * 1.5);margin-right:calc(var(--lh)/2)}.comments__author__data{flex-grow:1;min-width:1px}.comments__author__name{font-weight:700;line-height:calc(var(--lh) * 0.75);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comments__author__metadata{font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));line-height:calc(var(--lh) * 0.75);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comments__hash{color:inherit;text-decoration:none}.comments__reply{margin-bottom:calc(var(--lh)/2);background:0 0;display:block;height:var(--lh);border:0;color:var(--color-link);font:inherit;font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));cursor:pointer;background:var(--color-box-background);color:var(--color-text);padding:0 calc(var(--lh)/2)}.form{display:flex;flex-wrap:wrap;position:relative}.form__loader__wrapper{position:absolute;width:calc(100% + var(--lh));height:calc(100% + var(--lh));top:calc(var(--lh)/-2);left:calc(var(--lh)/-2);background:var(--color-background);display:flex;justify-content:center;align-items:center}.form__loader__wrapper--hidden{display:none}.form__loader{width:calc(var(--lh) * 1.5);height:calc(var(--lh) * 1.5);position:relative}.form__loader:before,.form__loader:after{content:"";position:absolute;width:100%;height:100%;border-radius:100%;border:3px solid transparent;border-top-color:var(--color-link)}.form__loader:after{animation:spin 1s infinite}.form__loader:before{border:3px solid var(--color-box-border)}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.form--hidden{display:none}.form__col{display:flex;flex-direction:column;flex-grow:1;width:100%;margin-bottom:calc(var(--lh)/2)}@media screen and (min-width:764px){.form__col:nth-of-type(2),.form__col:nth-of-type(3),.form__col:nth-of-type(4){width:100px;margin-right:calc(var(--lh)/2)}.form__col:nth-of-type(4){margin-right:0}}.form__row{display:flex;width:100%;flex-direction:row;align-items:center;min-width:1px;margin-bottom:calc(var(--lh)/2)}.form__row:last-child{margin-bottom:0}.form__label{font-weight:600;font-size:calc(var(--fz)/var(--type-scale))}.form__label--thin{font-weight:400;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.form__input{-webkit-appearance:none;border-radius:0;border:1px solid var(--color-box-border-dark);background-color:var(--color-background);height:calc(var(--lh) * 1.5);padding:0 calc(var(--lh)/2);color:var(--color-text);font:inherit}.form__input--textarea{padding:calc(var(--lh)/4) calc(var(--lh)/2);min-height:calc(var(--lh) * 4);resize:vertical}.form__tip{font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));margin-bottom:0;text-align:right}.form__checkboxlabel{font-size:calc(var(--fz)/var(--type-scale));white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:flex;align-items:center;margin-bottom:calc(var(--lh)/2);min-width:1px}.form__checkbox{margin-right:calc(var(--lh)/4);cursor:pointer}.form__confirmation{width:100%;background-color:var(--color-box-background);box-shadow:0 0 0 1px var(--color-box-border);padding:var(--lh);margin-bottom:calc(var(--lh)/2)}.form__confirmation--hidden{display:none}.form__button{background:var(--color-link);color:var(--color-background);border:0;font:inherit;padding:calc(var(--lh)/4) var(--lh);cursor:pointer;font-size:calc(var(--fz)/var(--type-scale));font-weight:600}</style></head><body><div class="wrapper wrapper--wide"><header class=header><a class=header__skip href=#main>Skip to content</a><div class=header__logo><a href=/>pawelgrzybek.com</a></div><nav><ul class=header__list><li class=header__item><a href=/about title=About>About</a></li><li class=header__item><a href=/archive title=Archive>Archive</a></li><li class=header__item><a href=/feed.xml title="RSS Feed">RSS</a></li><li class=header__item><a href=https://twitter.com/pawelgrzybek title="Pawel Grzybek on Twitter">Twitter</a></li><li class=header__item><a href=https://github.com/pawelgrzybek title="Pawel Grzybek on Github">Github</a></li></ul></nav></header></div><div class=wrapper><main id=main><article class="post js-post"><h1 class=post__title>WebP and AVIF images on a Hugo website</h1><p class=post__meta>Published: <time datetime=2021-01-04>2021.01.04</time> | 4 minutes read</p><p>Hugo is the tool that I use to generate this website statically. It&rsquo;s extremely fast, configurable and comes with a bunch of useful features. Added in <a href=https://gohugo.io/news/0.62.0-relnotes/>version 0.62</a> <a href=https://gohugo.io/getting-started/configuration-markup#markdown-render-hooks>Markdown Render Hooks</a> are revolutionary. This feature allows overriding default HTML markup generated by parsing Markdown links, headings and images.</p><p>The HTML <code>&lt;picture></code> element is convenient to serve multiple image versions for different scenarios. It may specify some alternative version based on the display resolution, screen density, operating system appearance mode, and the most optimised file format based on the browser support. Using modern formats like <a href=https://developers.google.com/speed/webp/>WebP</a> or even <a href=https://aomediacodec.github.io/av1-avif/>AVIF</a>, we can gain significant performance improvements.</p><p><picture>
<source srcset=/photos/2021-01-04-1.avif type=image/avif><source srcset=/photos/2021-01-04-1.webp type=image/webp><img src=/photos/2021-01-04-1.jpg alt="Image of WebP and AVIF specificatoins" loading=lazy decoding=async width=1400 height=986></picture></p><p>Using Hugo image render hook sounds like an excellent feature to take full advantage of modern <code>&lt;picture></code> tag capabilities. Instead of serving the only canonical file, we can do it&rsquo;s more performant siblings in WebP and AVIF format. Let&rsquo;s make it happen!</p><h2 id=override-default-image-html-markup-using-hugo-image-render-hook>Override default image HTML markup using Hugo image render hook <a href=#override-default-image-html-markup-using-hugo-image-render-hook class=post__hash>#</a></h2><p>Let&rsquo;s have a look at the Markdown image example and its parsed HTML equivalent.</p><div class=highlight><pre class=chroma><code class=language-md data-lang=md>![<span class=nt>Love of my life</span>](<span class=na>cat.jpg</span>)
</code></pre></div><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.jpg&#34;</span> <span class=na>alt</span><span class=o>=</span><span class=s>&#34;Love of my life&#34;</span><span class=p>&gt;</span>
</code></pre></div><p>It does the job, but we can do a tad better than that in 2021. Let&rsquo;s have a look at the example of an HTML that we would like to get.</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>picture</span><span class=p>&gt;</span>
  <span class=p>&lt;</span><span class=nt>source</span> <span class=na>srcset</span><span class=o>=</span><span class=s>&#34;cat.avif&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/avif&#34;</span> <span class=p>/&gt;</span>
  <span class=p>&lt;</span><span class=nt>source</span> <span class=na>srcset</span><span class=o>=</span><span class=s>&#34;cat.webp&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/webp&#34;</span> <span class=p>/&gt;</span>
  <span class=p>&lt;</span><span class=nt>img</span>
    <span class=na>src</span><span class=o>=</span><span class=s>&#34;cat.jpg&#34;</span>
    <span class=na>alt</span><span class=o>=</span><span class=s>&#34;Love of my life&#34;</span>
    <span class=na>loading</span><span class=o>=</span><span class=s>&#34;lazy&#34;</span>
    <span class=na>decoding</span><span class=o>=</span><span class=s>&#34;async&#34;</span>
    <span class=na>width</span><span class=o>=</span><span class=s>&#34;800&#34;</span>
    <span class=na>height</span><span class=o>=</span><span class=s>&#34;600&#34;</span>
  <span class=p>/&gt;</span>
<span class=p>&lt;/</span><span class=nt>picture</span><span class=p>&gt;</span>
</code></pre></div><p>Image render hook comes to the rescue. It&rsquo;s a basic HTML file that resides in <code>layouts/_default/_markup/render-image.html</code>. The implementation that works for me looks like this, but feel free to adjust it to your needs. If you struggle, feel free to <a href=https://twitter.com/pawelgrzybek>ping me on Twitter</a> or use the comment section below — I&rsquo;m more than happy to help, as always.</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>picture</span><span class=p>&gt;</span>
  {{ $isJPG := eq (path.Ext .Destination) &#34;.jpg&#34; }}
  {{ $isPNG := eq (path.Ext .Destination) &#34;.png&#34; }}

  {{ if ($isJPG) -}}
    {{ $avifPath:= replace .Destination &#34;.jpg&#34; &#34;.avif&#34; }}
    {{ $avifPathStatic:= printf &#34;static/%s&#34; $avifPath }}

    {{ if (fileExists $avifPathStatic) -}}
      <span class=p>&lt;</span><span class=nt>source</span> <span class=na>srcset</span><span class=o>=</span><span class=s>&#34;{{ $avifPath | safeURL }}&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/avif&#34;</span> <span class=p>&gt;</span>
    {{- end }}

    {{ $webpPath:= replace .Destination &#34;.jpg&#34; &#34;.webp&#34; }}
    {{ $webpPathStatic:= printf &#34;static/%s&#34; $webpPath }}

    {{ if (fileExists $webpPathStatic) -}}
      <span class=p>&lt;</span><span class=nt>source</span> <span class=na>srcset</span><span class=o>=</span><span class=s>&#34;{{ $webpPath | safeURL }}&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/webp&#34;</span> <span class=p>&gt;</span>
    {{- end }}
  {{- end }}

  {{ if ($isPNG) -}}
    {{ $avifPath:= replace .Destination &#34;.png&#34; &#34;.avif&#34; }}
    {{ $avifPathStatic:= printf &#34;static/%s&#34; $avifPath }}

    {{ if (fileExists $avifPathStatic) -}}
      <span class=p>&lt;</span><span class=nt>source</span> <span class=na>srcset</span><span class=o>=</span><span class=s>&#34;{{ $avifPath | safeURL }}&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/avif&#34;</span> <span class=p>&gt;</span>
    {{- end }}

    {{ $webpPath:= replace .Destination &#34;.png&#34; &#34;.webp&#34; }}
    {{ $webpPathStatic:= printf &#34;static/%s&#34; $webpPath }}

    {{ if (fileExists $webpPathStatic) -}}
      <span class=p>&lt;</span><span class=nt>source</span> <span class=na>srcset</span><span class=o>=</span><span class=s>&#34;{{ $webpPath | safeURL }}&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;image/webp&#34;</span> <span class=p>&gt;</span>
    {{- end }}
  {{- end }}

  {{ $img := imageConfig (add &#34;/static&#34; (.Destination | safeURL)) }}

  <span class=p>&lt;</span><span class=nt>img</span>
    <span class=na>src</span><span class=o>=</span><span class=s>&#34;{{ .Destination | safeURL }}&#34;</span>
    <span class=na>alt</span><span class=o>=</span><span class=s>&#34;{{ .Text }}&#34;</span>
    <span class=na>loading</span><span class=o>=</span><span class=s>&#34;lazy&#34;</span>
    <span class=na>decoding</span><span class=o>=</span><span class=s>&#34;async&#34;</span>
    <span class=na>width</span><span class=o>=</span><span class=s>&#34;{{ $img.Width }}&#34;</span>
    <span class=na>height</span><span class=o>=</span><span class=s>&#34;{{ $img.Height }}&#34;</span>
  <span class=p>/&gt;</span>
<span class=p>&lt;/</span><span class=nt>picture</span><span class=p>&gt;</span>
</code></pre></div><p>This solution is pretty safe to use. It assumes that the files are named the same as the file extension is the only difference. For example: <code>cat.jpg</code>, <code>cat.webp</code> and <code>cat.avif</code>. Before injecting a new WebP or AVIF resource to the markup, it first checks if a particular file exists in a <code>static</code> directory.</p><h2 id=generate-webp-and-avif-formats>Generate WebP and AVIF formats <a href=#generate-webp-and-avif-formats class=post__hash>#</a></h2><p>Some of the modern graphic design tools, like Sketch or Photoshop, fully support WebP format already. These are early days for AVIF format, but there are some GUI options for it as well. There&rsquo;s even <a href=https://squoosh.app>Squoosh web app</a> that does a great job. My preferred set of tooling to generate these modern formats are <code>cwebp</code> and <code>avifenc</code> command-line tools. If you are macOS user, <a href=https://brew.sh>Homebrew</a> is probably the best place where you can get them from.</p><pre><code>brew install webp
brew install joedrago/repo/avifenc
</code></pre><p>And this is an example how to use these CLIs.</p><pre><code>cwebp cat.jpg -o cat.webp
avifenc --min 10 --max 30 cat.jpg cat.avif
</code></pre><p>If you are planing to convert all images in a folder to a desired format, a snippet like this may come in handy.</p><pre><code>find ./ -type f -name '*.png' -exec sh -c 'avifenc --min 10 --max 30 $1 &quot;${1%.png}.avif&quot;' _ {} \;
find ./ -type f -name '*.jpg' -exec sh -c 'cwebp $1 -o &quot;${1%.jpg}.webp&quot;' _ {} \;
</code></pre><h2 id=the-result-of-it>The result of it <a href=#the-result-of-it class=post__hash>#</a></h2><p>The whole process of adding a hook and regenerating all images on my website took me about two hours. After all, I managed to serve to my visitors around 50% slimmer images — pretty significant performance gain. <a href=https://github.com/pawelgrzybek/pawelgrzybek.com>Source code to my blog on GitHub</a> is waiting for curious ones to be explored.</p><p>Hopefully, you found this article helpful, and you learned a thing or two. If you have any questions, please use the comments section below or <a href=https://twitter.com/pawelgrzybek>ping me on Twitter</a>. For now, stay safe 👋</p><div class=share><svg xmlns="http://www.w3.org/2000/svg" class="share__icon" viewBox="0 0 512 512"><path d="M512 113.2c-18.8 8.4-39.1 14-60.3 16.5 21.7-13 38.3-33.6 46.2-58.1-20.3 12-42.8 20.8-66.7 25.5-19.2-20.4-46.5-33.1-76.7-33.1-58 0-105 47-105 105 0 8.2.9 16.2 2.7 23.9-87.3-4.4-164.7-46.2-216.5-109.8-9 15.5-14.2 33.6-14.2 52.8.0 36.4 18.5 68.6 46.7 87.4-17.2-.5-33.4-5.3-47.6-13.1.0.4.0.9.0 1.3.0 50.9 36.2 93.4 84.3 103-8.8 2.4-18.1 3.7-27.7 3.7-6.8.0-13.3-.7-19.8-1.9 13.4 41.7 52.2 72.1 98.1 73-36 28.2-81.2 45-130.5 45-8.5.0-16.8-.5-25.1-1.5 46.6 29.9 101.8 47.2 161.1 47.2 193.2.0 298.9-160.1 298.9-298.9.0-4.6-.1-9.1-.3-13.6 20.5-14.7 38.3-33.2 52.4-54.3z"/></svg><p class=share__text>If you liked this article, please <a href="https://twitter.com/intent/tweet?text=WebP%20and%20AVIF%20images%20on%20a%20Hugo%20website&url=https%3a%2f%2fpawelgrzybek.com%2fwebp-and-avif-images-on-a-hugo-website%2f&via=pawelgrzybek" class=share__link title="Share on Twitter">share it on Twitter</a>.</p></div><h2 id=what-ya-think>What'ya think?</h2><form class="form js-form"><div class="form__loader__wrapper js-form__loader__wrapper form__loader__wrapper--hidden"><div class=form__loader></div></div><input type=hidden name=parent><div class=form__col><label class=form__label for=name->Name:</label>
<input class="form__input js-form-name" id=name- name=name type=text placeholder="Barack Obama" autocomplete=off autocorrect=off autocapitalize=off spellcheck=false required></div><div class=form__col><label class=form__label for=website->Website (optional):</label>
<input class="form__input js-form-website" id=website- name=website type=url placeholder=https://barackobama.com autocomplete=off autocorrect=off autocapitalize=off spellcheck=false></div><div class=form__col><label class=form__label for=twitter->Twitter (optional):</label>
<input class="form__input js-form-twitter" id=twitter- name=twitter type=text placeholder=barackobama autocomplete=off autocorrect=off autocapitalize=off spellcheck=false></div><div class=form__col><label class=form__label for=github->GitHub (optional):</label>
<input class="form__input js-form-github" id=github- name=github type=text placeholder=barackobama autocomplete=off autocorrect=off autocapitalize=off spellcheck=false></div><div class=form__col><label class=form__label for=comment-textarea->Comment:</label>
<textarea class="form__input form__input--textarea" id=comment-textarea- name=comment placeholder="I think…" required></textarea><p class=form__tip>👆 you can use Markdown here</p></div><label class=form__row><input class="form__checkbox js-form-save-data" name=save type=checkbox>
<span class="form__label form__label--thin">Save my data for the next time I comment</span></label><div class="form__confirmation js-form__confirmation form__confirmation--hidden">Your comment is awaiting moderation. Thanks!</div><div class=form__row><button class=form__button type=submit>Submit comment</button></div></form></article><script src=/comments.js></script></main><footer class=footer>Copyright © 2021 Pawel Grzybek</footer></div></body></html>