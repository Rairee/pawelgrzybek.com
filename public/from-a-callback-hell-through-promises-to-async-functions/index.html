<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=author content="Pawel Grzybek - https://pawelgrzybek.com"><meta name=generator content="Hugo 0.80.0"><title>From callback hell, through promises to async functions | pawelgrzybek.com</title><meta name=description content="The last few years have brought us lots of revolutionary features for working with asynchronous JavaScript operations. Let&rsquo;s review the most popular ones together."><meta property="og:site_name" content="pawelgrzybek.com"><meta property="og:title" content="From callback hell, through promises to async functions | pawelgrzybek.com"><meta property="og:url" content="https://pawelgrzybek.com/from-a-callback-hell-through-promises-to-async-functions/"><meta property="og:type" content="article"><meta property="og:description" content="The last few years have brought us lots of revolutionary features for working with asynchronous JavaScript operations. Let&rsquo;s review the most popular ones together."><meta property="og:image" content="https://pawelgrzybek.com/photos/2017-10-25.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@pawelgrzybek"><meta name=twitter:creator content="@pawelgrzybek"><link rel=canonical href=https://pawelgrzybek.com/from-a-callback-hell-through-promises-to-async-functions/><link rel=alternate type=application/rss+xml title=pawelgrzybek.com href=https://pawelgrzybek.com/feed.xml><link rel=alternate type=application/feed+json title=pawelgrzybek.com href=https://pawelgrzybek.com/feed.json><link rel=apple-touch-icon sizes=180x180 href=/assets/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/assets/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/favicon-16x16.png sizes=16x16><link rel=manifest href=/assets/manifest.json><link rel="shortcut icon" href=/assets/favicon.ico><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/assets/mstile-144x144.png"><meta name=theme-color content="#ffffff"><style>:root{--fz: 1rem;--fzb: 106.25%;--lh: 1.764705882rem;--type-scale: 1.25;--color-text: #24292e;--color-background: #fff;--color-link: #005cc5;--color-update-background: #fbebea;--color-update-border: #edb0ab;--color-box-background: #f7f7f7;--color-box-border: #eee;--color-box-border-dark: #ddd;--color-syntax-k: #006699;--color-syntax-s: #cc3300;--color-syntax-m: #ff6600;--color-syntax-c: #999;--color-syntax-nb: #366;--color-syntax-o: #555555;--color-syntax-na: #330099;--color-syntax-nv: #003333}@media screen and (min-width:764px){:root{--fzb: 112.5%;--lh: 1.77778rem}}@media(prefers-color-scheme:dark){:root{--color-text: #fafbfc;--color-background: #24292e;--color-link: #9ecbff;--color-update-background: #6d3733;--color-update-border: #522926;--color-box-background: hsl(210, 12%, 12%);--color-box-border: hsl(210, 12%, 20%);--color-box-border-dark: hsl(210, 12%, 30%);--color-syntax-k: #9ecbff;--color-syntax-s: #f97583;--color-syntax-m: #ffab70;--color-syntax-c: #6a737d;--color-syntax-nb: #28a745;--color-syntax-o: #959da5;--color-syntax-na: #fafbfc;--color-syntax-nv: #00b1b1}}::selection{background:var(--color-link);color:#fff;text-shadow:none}html{font-size:var(--fzb);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;-webkit-text-size-adjust:100%;box-sizing:border-box;scroll-behavior:smooth}*,*::before,*::after{margin:0;padding:0;box-sizing:inherit}body{background-color:var(--color-background);color:var(--color-text);font-family:-apple-system,BlinkMacSystemFont,segoe ui,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol;font-size:var(--fz);line-height:var(--lh)}img{display:block;max-width:100%;height:auto;border:0}a{background:0 0;color:var(--color-link);word-wrap:break-word}a:hover,a:focus,a:active{color:var(--color-text)}p,h1,h2,h3,h4,h5,h6{margin-bottom:var(--lh)}h1,h2,h3,h4,h5,h6{margin-top:calc(var(--lh) * 1.5);font-weight:700;text-decoration:none}h1{font-size:calc( var(--fz) * var(--type-scale) * var(--type-scale) * var(--type-scale));line-height:calc(var(--lh) * 1.5)}h2{font-size:calc(var(--fz) * var(--type-scale) * var(--type-scale))}h3{font-size:calc(var(--fz) * var(--type-scale))}h4{font-size:1rem}h5{font-size:calc(var(--fz)/var(--type-scale))}h6{font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale))}ul,ol{margin:0 0 var(--lh)var(--lh)}li ul,li ol{margin:0 0 0 var(--lh)}hr{display:block;height:var(--lh);border:0;box-shadow:0 1px 0 #eee}blockquote{margin-bottom:var(--lh);padding:var(--lh);background:var(--color-box-background);box-shadow:inset 0 0 0 1px var(--color-box-border)}blockquote p{margin:0;font-style:italic}figure{margin-bottom:var(--lh)}figcaption{font-size:var(--fz)/var(--type-scale)/var(--type-scale)}.wrapper{width:100%;max-width:calc(700px + (2 * var(--lh)));margin:0 auto;padding:0 var(--lh)}.wrapper--wide{max-width:calc(900px + (2 * var(--lh)))}.header{position:relative;padding:calc(var(--lh) * 2) 0;display:flex;flex-direction:column}.header__skip{position:absolute;top:0;left:0;padding:0 calc(var(--lh)/2);font-size:calc(var(--fz)/var(--type-scale));transform:scale(0)}.header__skip:focus{transform:scale(1)}.header__logo{display:flex;align-items:center;justify-content:center;margin:0;font-size:calc(var(--fz));line-height:var(--lh)}.header__logo a{display:flex;flex-direction:column;align-items:center;font-weight:700;margin:0 0 calc(var(--lh)/2)}.header__logo a::before{content:"";width:calc(var(--lh) * 2);height:calc(var(--lh) * 2);margin:0 0 calc(var(--lh)/2);background-image:url(/assets/logo.jpg);background-size:100% 100%;border-radius:var(--lh)}.header__list{height:100%;display:flex;align-items:center;justify-content:center;list-style:none;margin:0}.header__item{margin-right:calc(var(--lh)/2)}.header__item:last-of-type{margin-right:0}@media screen and (min-width:764px){.header{flex-direction:row;justify-content:space-between;padding:calc(var(--lh) * 3) 0}.header__logo a{flex-direction:row;margin:0}.header__logo a::before{content:"";width:calc(var(--lh) * 2);height:calc(var(--lh) * 2);margin:0 calc(var(--lh)/2) 0 0;background-image:url(/assets/logo.jpg);background-size:100% 100%;border-radius:var(--lh)}}@media screen and (min-width:964px){.header__logo::after{font-weight:400;white-space:pre;color:var(--color-text);content:" | Software Engineer at Mindera"}}.post{margin-bottom:calc(var(--lh) * 3)}.post__title{margin-top:0}.post__url{color:var(--color-text);text-decoration:none}.post__url:hover{color:var(--color-link)}.post__meta{margin-top:calc(var(--lh) * -1);font-size:calc(var(--fz)/var(--type-scale))}.post__more{text-decoration:none;vertical-align:top}.post__hash{text-decoration:none;margin-left:calc(var(--lh)/4);color:var(--color-text);opacity:.25}.post__hash:hover{color:var(--color-link);opacity:1}.footer{color:var(--color-text);font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));font-weight:700;text-decoration:none;vertical-align:top;padding:calc(var(--lh) * 2) 0}.pager{display:flex}.pager__btn{flex-grow:1;font-size:calc(var(--fz)/var(--type-scale));font-weight:700;text-decoration:none;vertical-align:top}.pager__btn--prev{text-align:left}.pager__btn--next{text-align:right}.share{display:flex;align-items:center;background-color:var(--color-box-background);box-shadow:0 0 0 1px var(--color-box-border);margin:calc(var(--lh) * 2) 0;padding:calc(var(--lh)/2);font-size:calc(var(--fz)/var(--type-scale))}.share__icon{fill:#1da1f2;margin-right:calc(var(--lh)/2);width:var(--fz);height:var(--fz);flex-shrink:0}.share__text{margin:0}.archive{margin-left:0;list-style:none}.archive__item{padding:calc(var(--lh)/2) 0;box-shadow:0 1px 0 0 var(--color-box-border)}.archive__link{font-weight:700;text-decoration:none;color:var(--color-text)}.archive__link:hover{color:var(--color-link)}.archive__date{margin:0;font-size:calc(var(--fz)/var(--type-scale))}code,pre{border-radius:3px;background-color:var(--color-box-background);font-family:SFMono-Regular,Consolas,liberation mono,Menlo,Courier,monospace;font-size:.888889rem;vertical-align:top}pre{margin-bottom:var(--lh);padding:var(--lh);box-shadow:0 0 0 1px var(--color-box-border);overflow-x:auto}p code,li code{padding:4px 6px;box-shadow:0 0 0 1px var(--color-box-border)}kbd{border-radius:3px;background-color:var(--color-box-background);font-family:SFMono-Regular,Consolas,liberation mono,Menlo,Courier,monospace;font-size:.888889rem;vertical-align:top;padding:4px 6px;box-shadow:0 0 0 1px var(--color-box-border)}.chroma{background-color:var(--color-box-background)}.chroma .err{background-color:#faa;color:#a00}.chroma .lntd{margin:0;padding:0;border:0;vertical-align:top}.chroma .lntable{display:block;width:auto;margin:0;padding:0;border:0;border-spacing:0;overflow:auto}.chroma .hl{display:block;width:100%;background-color:var(--color-box-border)}.chroma .lnt{display:block;margin-right:.4em;padding:0 .4em;opacity:.5}.chroma .ln{margin-right:.4em;padding:0 .4em}.chroma .k{color:var(--color-syntax-k);font-weight:700}.chroma .kc{color:var(--color-syntax-k);font-weight:700}.chroma .kd{color:var(--color-syntax-k);font-weight:700}.chroma .kn{color:var(--color-syntax-k);font-weight:700}.chroma .kp{color:var(--color-syntax-k)}.chroma .kr{color:var(--color-syntax-k);font-weight:700}.chroma .kt{color:#078;font-weight:700}.chroma .na{color:var(--color-syntax-na)}.chroma .nb{color:var(--color-syntax-nb)}.chroma .nc{color:#0a8;font-weight:700}.chroma .no{color:#360}.chroma .nd{color:#99f}.chroma .ni{color:#999;font-weight:700}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#c0f}.chroma .nl{color:#99f}.chroma .nn{color:#0cf;font-weight:700}.chroma .nt{color:var(--color-syntax-na);font-weight:700}.chroma .nv{color:var(--color-syntax-nv)}.chroma .s{color:var(--color-syntax-s)}.chroma .sa{color:var(--color-syntax-s)}.chroma .sb{color:var(--color-syntax-s)}.chroma .sc{color:var(--color-syntax-s)}.chroma .dl{color:var(--color-syntax-s)}.chroma .sd{color:var(--color-syntax-s);font-style:italic}.chroma .s2{color:var(--color-syntax-s)}.chroma .se{color:var(--color-syntax-s);font-weight:700}.chroma .sh{color:var(--color-syntax-s)}.chroma .si{color:#a00}.chroma .sx{color:var(--color-syntax-s)}.chroma .sr{color:#3aa}.chroma .s1{color:var(--color-syntax-s)}.chroma .ss{color:#fc3}.chroma .m{color:var(--color-syntax-m)}.chroma .mb{color:var(--color-syntax-m)}.chroma .mf{color:var(--color-syntax-m)}.chroma .mh{color:var(--color-syntax-m)}.chroma .mi{color:var(--color-syntax-m)}.chroma .il{color:var(--color-syntax-m)}.chroma .mo{color:var(--color-syntax-m)}.chroma .o{color:var(--color-syntax-o)}.chroma .ow{color:#000;font-weight:700}.chroma .c{color:#999;font-style:italic}.chroma .ch{color:#999;font-style:italic}.chroma .cm{color:#999;font-style:italic}.chroma .c1{color:#999;font-style:italic}.chroma .cs{color:#999;font-style:italic;font-weight:700}.chroma .cp{color:#099}.chroma .cpf{color:#099}.chroma .gd{background-color:#fcc}.chroma .ge{font-style:italic}.chroma .gr{color:red}.chroma .gh{color:#030;font-weight:700}.chroma .gi{background-color:#cfc}.chroma .go{color:#aaa}.chroma .gp{color:#009;font-weight:700}.chroma .gs{font-weight:700}.chroma .gu{color:#030;font-weight:700}.chroma .gt{color:#9c6}.chroma .w{color:#bbb}.update{position:relative;padding:var(--lh);background-color:var(--color-update-background);box-shadow:0 0 0 1px var(--color-update-border)}.update::before{position:absolute;top:calc(var(--lh)/-2);left:calc(var(--lh)/2);height:var(--lh);padding:0 calc(var(--lh)/2);background-color:var(--color-update-border);color:#fff;font-size:calc(var(--fz)/var(--type-scale));font-weight:700;content:"Update"}.comments{list-style:none;margin-left:0}.comments__item{scroll-margin-top:var(--lh)}.comments__item .comments{box-shadow:inset 1px 0 0 var(--color-box-border-dark);padding-left:var(--lh)}.comments__item .comments .comments__author{position:relative}.comments__item .comments .comments__author::before{position:absolute;top:50%;left:calc(var(--lh) * -1);width:calc(var(--lh)/4);height:calc(var(--lh)/4);background:var(--color-box-border-dark);transform:translate(-50%,-50%);border-radius:50%;content:""}.comments__wrapper{margin-bottom:var(--lh);word-wrap:break-word}.comments__author{display:flex;margin-bottom:var(--lh)}.comments__author__photo{width:calc(var(--lh) * 1.5);height:calc(var(--lh) * 1.5);margin-right:calc(var(--lh)/2)}.comments__author__data{flex-grow:1;min-width:1px}.comments__author__name{font-weight:700;line-height:calc(var(--lh) * 0.75);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comments__author__metadata{font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));line-height:calc(var(--lh) * 0.75);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.comments__hash{color:inherit;text-decoration:none;text-transform:uppercase}.comments__reply{margin-bottom:calc(var(--lh)/2);background:0 0;display:block;height:var(--lh);border:0;color:var(--color-link);font:inherit;font-size:calc(var(--fz)/var(--type-scale));cursor:pointer}.form{display:flex;flex-wrap:wrap;position:relative}.form--sending{opacity:.25}.form--sending::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%}.form--hidden{display:none}.form__col{display:flex;flex-direction:column;flex-grow:1;width:100%;margin-bottom:calc(var(--lh)/2)}@media screen and (min-width:764px){.form__col:nth-of-type(2),.form__col:nth-of-type(3),.form__col:nth-of-type(4){width:100px;margin-right:calc(var(--lh)/2)}.form__col:nth-of-type(4){margin-right:0}}.form__row{display:flex;width:100%;flex-direction:row;align-items:center;min-width:1px;margin-bottom:calc(var(--lh)/2)}.form__label{font-weight:600;font-size:calc(var(--fz)/var(--type-scale))}.form__label--thin{font-weight:400;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.form__input{-webkit-appearance:none;border-radius:0;border:1px solid var(--color-box-border-dark);background-color:var(--color-background);height:calc(var(--lh) * 1.5);padding:0 calc(var(--lh)/2);color:var(--color-text);font:inherit}.form__input--textarea{padding:calc(var(--lh)/4) calc(var(--lh)/2);min-height:calc(var(--lh) * 4);resize:vertical}.form__tip{font-size:calc(var(--fz)/var(--type-scale)/var(--type-scale));margin-bottom:0;text-align:right}.form__checkboxlabel{font-size:calc(var(--fz)/var(--type-scale));white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:flex;align-items:center;margin-bottom:calc(var(--lh)/2);min-width:1px}.form__checkbox{margin-right:calc(var(--lh)/4);cursor:pointer}.form__button{background:var(--color-link);color:var(--color-background);border:0;font:inherit;padding:calc(var(--lh)/4) var(--lh);cursor:pointer;font-size:calc(var(--fz)/var(--type-scale));font-weight:600}.moderation{background-color:var(--color-box-background);box-shadow:0 0 0 1px var(--color-box-border);padding:calc(var(--lh)/2);font-size:calc(var(--fz)/var(--type-scale))}.moderation--hidden{display:none}</style></head><body><div class="wrapper wrapper--wide"><header class=header><a class=header__skip href=#main>Skip to content</a><div class=header__logo><a href=/>pawelgrzybek.com</a></div><nav><ul class=header__list><li class=header__item><a href=/about title=About>About</a></li><li class=header__item><a href=/archive title=Archive>Archive</a></li><li class=header__item><a href=/feed.xml title="RSS Feed">RSS</a></li><li class=header__item><a href=https://twitter.com/pawelgrzybek title="Pawel Grzybek on Twitter">Twitter</a></li><li class=header__item><a href=https://github.com/pawelgrzybek title="Pawel Grzybek on Github">Github</a></li></ul></nav></header></div><div class=wrapper><main id=main><article class="post js-post"><h1 class=post__title>From callback hell, through promises to async functions</h1><p class=post__meta>Published: <time datetime=2017-10-25>2017.10.25</time> | 4 minutes read</p><p>Working with asynchronous JavaScript has changed a lot in the last few years. When <code>Promise</code>s were introduced to ECMAScript a few years ago life became a dream. Two years later, the <code>async</code> function was added to the specification — I still can&rsquo;t believe how nice and easy to read it is! What&rsquo;s next? Time will tell, but now let&rsquo;s review what we went through to get where we are. You have to agree — a random Chuck Norris joke generator is the perfect demo program!</p><h2 id=callbacks>Callbacks <a href=#callbacks class=post__hash>#</a></h2><p>If you joined the JS stage a few years ago or earlier you&rsquo;ll remember the <a href=https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming)>doom</a> that you could easily end up in by nesting callbacks. Luckily those days are over. A simple <code>XMLHttpRequest</code> request fetches a piece of JSON from an API and it isn&rsquo;t hard to read (yet). Imagine a situation where you have to call another request based on the result of the first one — I don&rsquo;t miss that.</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kd>function</span> <span class=nx>getRandomJoke</span><span class=p>()</span> <span class=p>{</span>

  <span class=c1>// show loading screen
</span><span class=c1></span>  <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>

  <span class=kd>var</span> <span class=nx>xhr</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>();</span>
  <span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;https://api.icndb.com/jokes/random/1&#39;</span><span class=p>);</span>
  <span class=nx>xhr</span><span class=p>.</span><span class=nx>responseType</span> <span class=o>=</span> <span class=s1>&#39;json&#39;</span><span class=p>;</span>

  <span class=nx>xhr</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span> <span class=nx>onload</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// print a joke
</span><span class=c1></span>    <span class=nx>main</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>xhr</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>value</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>joke</span><span class=p>;</span>

    <span class=c1>// hide loading screen
</span><span class=c1></span>    <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>
  <span class=p>};</span>

  <span class=nx>xhr</span><span class=p>.</span><span class=nx>onerror</span> <span class=o>=</span> <span class=kd>function</span> <span class=nx>onerror</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// print an error
</span><span class=c1></span>    <span class=nx>main</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=s1>&#39;Error :-(&#39;</span><span class=p>;</span>

    <span class=c1>// hide loading screen
</span><span class=c1></span>    <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>
  <span class=p>};</span>

  <span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div><p><p data-height=380 data-theme-id=dark data-slug-hash=XeLJzJ data-default-tab=result data-user=pawelgrzybek data-embed-version=2 data-pen-title=2017-10-24-1 class=codepen>See the Pen <a href=https://codepen.io/pawelgrzybek/pen/XeLJzJ/>2017-10-24-1</a> by Pawel Grzybek (<a href=https://codepen.io/pawelgrzybek>@pawelgrzybek</a>) on <a href=https://codepen.io>CodePen</a>.</p><script async src=https://production-assets.codepen.io/assets/embed/ei.js></script></p><h2 id=the-promise-of-a-better-future>The promise of a better future <a href=#the-promise-of-a-better-future class=post__hash>#</a></h2><p>An asynchronous operation takes some time and the only thing that we can be assured of ahead of time is the fact that it is going to be resolved or rejected. This could easily be the definition of a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise>JavaScript <code>Promise</code></a>. It landed in the ECMAScript spec in 2015 and totally revolutionized the way developers handle asynchronous programs. Promised-based methods (the ones that return the promise) are slowly replacing callback-based equivalents and <code>fetch()</code>, used in example below, is one of them.</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kd>function</span> <span class=nx>getRandomJoke</span><span class=p>()</span> <span class=p>{</span>

  <span class=c1>// show loading screen
</span><span class=c1></span>  <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>

  <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://api.icndb.com/jokes/random/1&#39;</span><span class=p>)</span>
    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span> <span class=p>=&gt;</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>joke</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// print a joke
</span><span class=c1></span>      <span class=nx>main</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>joke</span><span class=p>.</span><span class=nx>value</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>joke</span><span class=p>;</span>

      <span class=c1>// hide loading screen
</span><span class=c1></span>      <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>
    <span class=p>})</span>
    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// print an error
</span><span class=c1></span>      <span class=nx>main</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=sb>`Error: </span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>

      <span class=c1>// hide loading screen
</span><span class=c1></span>      <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>
    <span class=p>});</span>
<span class=p>}</span>
</code></pre></div><p><p data-height=380 data-theme-id=dark data-slug-hash=dVBPyM data-default-tab=result data-user=pawelgrzybek data-embed-version=2 data-pen-title=2017-10-24-2 class=codepen>See the Pen <a href=https://codepen.io/pawelgrzybek/pen/dVBPyM/>2017-10-24-2</a> by Pawel Grzybek (<a href=https://codepen.io/pawelgrzybek>@pawelgrzybek</a>) on <a href=https://codepen.io>CodePen</a>.</p><script async src=https://production-assets.codepen.io/assets/embed/ei.js></script></p><p>Living on the bleeding edge? Safari 11, Google Chrome 63, EDGE and Node under the <code>-​-harmony-promise-finally</code> flag comes with the additional handler <code>finally()</code>. Keep it DRY!</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kd>function</span> <span class=nx>getRandomJoke</span><span class=p>()</span> <span class=p>{</span>

  <span class=c1>// show loading screen
</span><span class=c1></span>  <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>

  <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://api.icndb.com/jokes/random/1&#39;</span><span class=p>)</span>
    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>response</span> <span class=p>=&gt;</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>joke</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// print a joke
</span><span class=c1></span>      <span class=nx>main</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>joke</span><span class=p>.</span><span class=nx>value</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>joke</span><span class=p>;</span>
    <span class=p>})</span>
    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// print an error
</span><span class=c1></span>      <span class=nx>main</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=sb>`Error: </span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
    <span class=p>})</span>
    <span class=p>.</span><span class=k>finally</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=c1>// hide loading screen
</span><span class=c1></span>      <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>
    <span class=p>});</span>
<span class=p>}</span>
</code></pre></div><p><p data-height=380 data-theme-id=dark data-slug-hash=wrLBmE data-default-tab=result data-user=pawelgrzybek data-embed-version=2 data-pen-title=2017-10-24-3 class=codepen>See the Pen <a href=https://codepen.io/pawelgrzybek/pen/wrLBmE/>2017-10-24-3</a> by Pawel Grzybek (<a href=https://codepen.io/pawelgrzybek>@pawelgrzybek</a>) on <a href=https://codepen.io>CodePen</a>.</p><script async src=https://production-assets.codepen.io/assets/embed/ei.js></script></p><h2 id=async-code-sync-look>Async code, sync look <a href=#async-code-sync-look class=post__hash>#</a></h2><p>In 2017 ECMAScript introduced another game changer — the <a href=https://tc39.github.io/ecmascript-asyncawait/>Async Function</a>. It makes working with asynchronous operations very intuitive because it is written in the same way as synchronous code with two tiny nuances — an <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function><code>async</code></a> keyword in front of a function declaration and an <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await><code>await</code></a> operator as a promise prefix. Apart from it just being syntactically much nicer to read, it comes with <a href=https://mathiasbynens.be/notes/async-stack-traces>optimizations in JavaScript engines</a> as well. Based on the current <a href="https://caniuse.com/#feat=async-functions">browser support</a> and the help that <a href=https://github.com/babel/babel-preset-env>babel-preset-env</a> can offer this is my preferred way of working with asynchronous JavaScript.</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>getRandomJoke</span> <span class=o>=</span> <span class=kr>async</span><span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>

  <span class=c1>// show loading screen
</span><span class=c1></span>  <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>

  <span class=k>try</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://api.icndb.com/jokes/random/1&#39;</span><span class=p>);</span>
    <span class=kr>const</span> <span class=nx>joke</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>

    <span class=c1>// print a joke
</span><span class=c1></span>    <span class=nx>main</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>joke</span><span class=p>.</span><span class=nx>value</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>joke</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// print an error
</span><span class=c1></span>    <span class=nx>main</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=sb>`Error: </span><span class=si>${</span><span class=nx>err</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=k>finally</span> <span class=p>{</span>
    <span class=c1>// hide loading screen
</span><span class=c1></span>    <span class=nx>loading</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;loading--active&#39;</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>};</span>
</code></pre></div><p><p data-height=380 data-theme-id=dark data-slug-hash=pWXJPy data-default-tab=result data-user=pawelgrzybek data-embed-version=2 data-pen-title=2017-10-24-4 class=codepen>See the Pen <a href=https://codepen.io/pawelgrzybek/pen/pWXJPy/>2017-10-24-4</a> by Pawel Grzybek (<a href=https://codepen.io/pawelgrzybek>@pawelgrzybek</a>) on <a href=https://codepen.io>CodePen</a>.</p><script async src=https://production-assets.codepen.io/assets/embed/ei.js></script></p><p>Hopefully you liked this quick time travel through asynchronous programming in JavaScript. The changes introduced in latest versions of the language are really exciting and I am really looking forward to see what&rsquo;s next! Until next time pals!</p><div class=share><svg xmlns="http://www.w3.org/2000/svg" class="share__icon" viewBox="0 0 512 512"><path d="M512 113.2c-18.8 8.4-39.1 14-60.3 16.5 21.7-13 38.3-33.6 46.2-58.1-20.3 12-42.8 20.8-66.7 25.5-19.2-20.4-46.5-33.1-76.7-33.1-58 0-105 47-105 105 0 8.2.9 16.2 2.7 23.9-87.3-4.4-164.7-46.2-216.5-109.8-9 15.5-14.2 33.6-14.2 52.8.0 36.4 18.5 68.6 46.7 87.4-17.2-.5-33.4-5.3-47.6-13.1.0.4.0.9.0 1.3.0 50.9 36.2 93.4 84.3 103-8.8 2.4-18.1 3.7-27.7 3.7-6.8.0-13.3-.7-19.8-1.9 13.4 41.7 52.2 72.1 98.1 73-36 28.2-81.2 45-130.5 45-8.5.0-16.8-.5-25.1-1.5 46.6 29.9 101.8 47.2 161.1 47.2 193.2.0 298.9-160.1 298.9-298.9.0-4.6-.1-9.1-.3-13.6 20.5-14.7 38.3-33.2 52.4-54.3z"/></svg><p class=share__text>If you liked this article, please <a href="https://twitter.com/intent/tweet?text=From%20callback%20hell%2c%20through%20promises%20to%20async%20functions&url=https%3a%2f%2fpawelgrzybek.com%2ffrom-a-callback-hell-through-promises-to-async-functions%2f&via=pawelgrzybek" class=share__link title="Share on Twitter">share it on Twitter</a>.</p></div><h2 id=comments>Comments</h2><ul class=comments><li class=comments__item id=comment-e59d073d><div class=comments__wrapper><div class=comments__author><img src=/assets/comment.svg alt=malik class=comments__author__photo><div class=comments__author__data><div class=comments__author__name>malik</div><div class=comments__author__metadata><time datetime=2017-10-25>2017.10.25, 15:50</time>,
<a class=comments__hash href=#comment-e59d073d>ID: e59d073d</a></div></div></div><p>I recently came across the async function when I was exploring promises in JavaScript. Great explanation of how it works, I was able to implement another version of this as well. Cheers :)</p><button class="comments__reply js-comments__reply">
Reply to malik</button><form class="form form--hidden js-form"><input type=hidden name=parent value=e59d073d><div class=form__col><label class=form__label for=name-e59d073d>Name:</label>
<input class="form__input js-form-name" id=name-e59d073d name=name type=text placeholder="Barack Obama" required></div><div class=form__col><label class=form__label for=website-e59d073d>Website (optional):</label>
<input class="form__input js-form-website" id=website-e59d073d name=website type=url placeholder=https://barackobama.com></div><div class=form__col><label class=form__label for=twitter-e59d073d>Twitter (optional):</label>
<input class="form__input js-form-twitter" id=twitter-e59d073d name=twitter type=text placeholder=barackobama></div><div class=form__col><label class=form__label for=github-e59d073d>GitHub (optional):</label>
<input class="form__input js-form-github" id=github-e59d073d name=github type=text placeholder=barackobama></div><div class=form__col><label class=form__label for=comment-textarea-e59d073d>Comment:</label>
<textarea class="form__input form__input--textarea" id=comment-textarea-e59d073d name=comment placeholder="I think…" required></textarea><p class=form__tip>👆 you can use Markdown here</p></div><label class=form__row><input class="form__checkbox js-form-save-data" name=save type=checkbox>
<span class="form__label form__label--thin">Save my data for the next time I comment</span></label><div class=form__row><button class=form__button type=submit>Submit comment</button></div></form><div class="moderation moderation--hidden">Your comment is awaiting moderation. Thanks!</div></div><ul class=comments><li class=comments__item id=comment-78eacb09><div class=comments__wrapper><div class=comments__author><img src=/assets/logo.jpg alt="Pawel Grzybek" class=comments__author__photo><div class=comments__author__data><div class=comments__author__name>Pawel Grzybek</div><div class=comments__author__metadata><time datetime=2017-10-25>2017.10.25, 17:25</time>,
<a class=comments__hash href=#comment-78eacb09>ID: 78eacb09</a></div></div></div><p>I'm glad that you like it. Have a good day @malikbrowne:disqus 🥑</p><button class="comments__reply js-comments__reply">
Reply to Pawel Grzybek</button><form class="form form--hidden js-form"><input type=hidden name=parent value=78eacb09><div class=form__col><label class=form__label for=name-78eacb09>Name:</label>
<input class="form__input js-form-name" id=name-78eacb09 name=name type=text placeholder="Barack Obama" required></div><div class=form__col><label class=form__label for=website-78eacb09>Website (optional):</label>
<input class="form__input js-form-website" id=website-78eacb09 name=website type=url placeholder=https://barackobama.com></div><div class=form__col><label class=form__label for=twitter-78eacb09>Twitter (optional):</label>
<input class="form__input js-form-twitter" id=twitter-78eacb09 name=twitter type=text placeholder=barackobama></div><div class=form__col><label class=form__label for=github-78eacb09>GitHub (optional):</label>
<input class="form__input js-form-github" id=github-78eacb09 name=github type=text placeholder=barackobama></div><div class=form__col><label class=form__label for=comment-textarea-78eacb09>Comment:</label>
<textarea class="form__input form__input--textarea" id=comment-textarea-78eacb09 name=comment placeholder="I think…" required></textarea><p class=form__tip>👆 you can use Markdown here</p></div><label class=form__row><input class="form__checkbox js-form-save-data" name=save type=checkbox>
<span class="form__label form__label--thin">Save my data for the next time I comment</span></label><div class=form__row><button class=form__button type=submit>Submit comment</button></div></form><div class="moderation moderation--hidden">Your comment is awaiting moderation. Thanks!</div></div></li></ul></li></ul><h2 id=what-ya-think>What'ya think?</h2><form class="form js-form"><input type=hidden name=parent><div class=form__col><label class=form__label for=name->Name:</label>
<input class="form__input js-form-name" id=name- name=name type=text placeholder="Barack Obama" required></div><div class=form__col><label class=form__label for=website->Website (optional):</label>
<input class="form__input js-form-website" id=website- name=website type=url placeholder=https://barackobama.com></div><div class=form__col><label class=form__label for=twitter->Twitter (optional):</label>
<input class="form__input js-form-twitter" id=twitter- name=twitter type=text placeholder=barackobama></div><div class=form__col><label class=form__label for=github->GitHub (optional):</label>
<input class="form__input js-form-github" id=github- name=github type=text placeholder=barackobama></div><div class=form__col><label class=form__label for=comment-textarea->Comment:</label>
<textarea class="form__input form__input--textarea" id=comment-textarea- name=comment placeholder="I think…" required></textarea><p class=form__tip>👆 you can use Markdown here</p></div><label class=form__row><input class="form__checkbox js-form-save-data" name=save type=checkbox>
<span class="form__label form__label--thin">Save my data for the next time I comment</span></label><div class=form__row><button class=form__button type=submit>Submit comment</button></div></form><div class="moderation moderation--hidden">Your comment is awaiting moderation. Thanks!</div></article><script src=/comments.js></script></main><footer class=footer>Copyright © 2021 Pawel Grzybek</footer></div></body></html>